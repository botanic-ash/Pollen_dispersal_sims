# Modified Pollen_dispersal_sims
A project repository by Ash Hamilton for estimating error rate and paretage from offspring data

This repo is forked from Kaylee Rosenberger; it uses her sim2coal data and code written by her to generate offpsring from that data. 


#### Overview
Simulations (such as those done in the Simcoal software) have been used to test seed sampling strategies used to inform botanic gardens and arboreta. These informed sampling strategies are one way of ensuring that a genetically diverse and representative sample has been collected, to be conserved for future use in restoration efforts for example. However, the simulation software Simcoal models a simplified version of mating and pollen dispersal within the population. For example, any tree in the population has equal opportunity to donate pollen to any other tree in the population. In reality, for many species, the trees closest to another will donate the majority of the pollen. Furthermore, previous seed sampling strategies tested by simulations have assumed that one seed be sampled from one maternal tree--but in reality, collectors will sample many seeds from a given tree if they are available. While it has been shown that sampling as many unique maternal trees as possible will provide the most genetically diverse collection, this is often not feasible or realistic. We aim to quanitfy the difference in genetic diversity captured using a combination of different pollen dispersal patterns and sampling techniques. 

#### Approach
At a high level, the approach is as follows: (1) simulate populations to create a genetic dataset representing a plant species, (2) apply sampling functions to this dataset, such that we can create seeds from different pollination, seed sampler decisions etc., (3) each time we sample, compare the genetic diversity in our seed set to the total genetic diversity available, (4) compare efficiency of genetic diversity conserved among the different situations e.g. 5 seeds and 10 mothers vs. 10 seeds and 5 mothers, or skewed sampling or pollination and non skewed sampling or pollination.

Here, we simulate two hypothetical species using the software Simcoal 2–one species with a single population of size 2500 individuals, and one species with two populations each of size 2500. These hypothetical species are simple models that we use to answer our broad question and to make it applicable to many types of species. The two hypothetical species are of medium sizes and moderately rare. We use two versions to show that the results are robust to multiple populations. 

To increase the complexity of mating, pollen dispersal, and seed creation that is represented in base Simcoal 2, we pass the simulation output files to a custom function that randomly selects maternal trees and pollen donors to create a "seed." To create a seed, the function randomly selects alleles from each parent for seeds to inherit. In other words, the function creates seed sets from selected trees, and samples them to test different seed sampling strategies in a realistic way. The function we have written allows for many different combinations of parameters to be passed to the function–-parameters include the number of maternal trees, pollen donors, and pollen donation probability. This allows for testing of many different scenarios. We define a scenario as different combinations of parameters that are passed to the function.

#### Function parameters and assumptions
We created different scenarios to pass to the seed creation function. The scenarios are different combinations of paramters--parameters include the number of maternal trees collectors will sample from, the number of seeds to be sampled from each tree, the pollen donor notes, and the total seeds collected. 
In this project, there are three different options for pollen donation. ‘All eligible’ describes a scenario in which the number of pollen donors is equal to the number of seeds to be sampled (so if 5 seeds are being sampled on each tree, then there are 5 potential pollen donors), and each of the donors has equal probability to pollinate another tree to make a seed. ‘All same’ describes a scenario in which one father is randomly selected to pollinate every seed sampled from a given maternal tree (ie., one tree donates 100% of the pollen for another tree).  ‘Skewed’ describes scenarios in which there are multiple potential pollen donors, but where one or two donate the majority of the pollen and the remaining donors have a very small chance to donate. This represents a scenario in which the ‘closest’ trees can donate more pollen (though note we have not simulated spatial structure). The details for the skewed scenarios are shown below:
	Max of 10 possible pollen donors, one with 60% chance to donate pollen, one with 20% chance to donate, 3 with 5% chance to donate, 5 with 1% chance. So for as many fathers are needed, we choose that many fathers from this probability list up to 10.
For the ‘skewed’ scenarios, we cap the number of pollen donors at 10, such that each donor has at least a 1% chance to donate pollen. 

We also incorporate two types of scenarios of seed collecting--ideal and realistic. In the ideal scenarios, we implement a simple approach where an equal number of seeds are sampled from every tree. This is a simplified version of reality, so we implement a more realistic approach where the number of seeds sampled from each tree varies. These scenarios representing a seed collector taking many seeds from one tree, and taking fewer from other trees. In reality, some trees in a population have very high reproductive output, while others only make a few seeds. 

#### Directory contents
**R project:** this file keeps all directory contents contained and easy to access. it standardizes most file paths as relative paths from the root directory (though some external functions have issues with it). makes code easier for others to use! 
**Simulations:** contains simulation parameter and output files representing a hypothetical species 
        one_pop_2500: files represent a hypothetical species with one population of size 2500  
        two_pop_2500: files represent a hypothetical species with two populations each of size 2500  
**R-scripts:** contains R scripts used for data importing and processing, and sampling scripts
    arp2gen_edit.R: edited version of the function arp2gen
    import_seed_functions.R: this script defines the functions used in the main loop script. There are multiple functions--some import and convert data into more usable file types (genalex). The main function in this loop (sample_seed) imports a genetic data and creates new seed sets. The number of pollen donors, number of seeds sampled per tree, and number of trees to sample from are taken as function parameters, making the inputs highly customizable.   
    defining_function_parameters.R: this script makes lists that containing sets of function parameters to be passed to the sample_seed function. 
    main_loop.R: this script loops over simulation replicates and calls the functions defined in the import_seed_functions.R script to run the functions with varying inputs, defined in defining_function_parameters.R  
    visualizing_results.R: script that creates plots with ggplot
**Figures:** contains figures and plots created in R with ggplot, or in the software Inkscape 